#include <iostream>
#include <unordered_map>
#include <cmath>

// Structure to represent Sensor Data
struct SensorData {
    float acceleration[3];  // Accelerometer data: x, y, z
    float gyroscope[3];     // Gyroscope data: x, y, z
    float magnetometer[3];  // Magnetometer data: x, y, z
};

// Structure to represent a Wearable Device
struct WearableDevice {
    int id;
    bool isWorn;            // Wear status
    SensorData lastData;    // Last sensor data collected
};

// Simple class to manage Wearable Devices
class WearableDetectionSystem {
private:
    std::unordered_map<int, WearableDevice> devices;

    // Helper function to compute magnitude of a 3D vector
    float computeMagnitude(float data[3]) {
        return sqrt(data[0] * data[0] + data[1] * data[1] + data[2] * data[2]);
    }

public:
    // Function to add a wearable device
    void addDevice(int id) {
        devices[id] = {id, false, {0, 0, 0, 0, 0, 0, 0, 0, 0}}; // Initialize with zeros
    }

    // Function to record sensor data
    void recordSensorData(int deviceId, const SensorData& data) {
        if (devices.find(deviceId) != devices.end()) {
            devices[deviceId].lastData = data;
        } else {
            std::cout << "Device ID not found!" << std::endl;
        }
    }

    // Function to detect wear status
    void detectWearStatus() {
        const float ACCELERATION_THRESHOLD = 1.0f; // Example threshold
        const float GYROSCOPE_THRESHOLD = 1.0f;    // Example threshold
        const float MAGNETOMETER_THRESHOLD = 1.0f; // Example threshold

        for (auto& device : devices) {
            float accMag = computeMagnitude(device.second.lastData.acceleration);
            float gyroMag = computeMagnitude(device.second.lastData.gyroscope);
            float magMag = computeMagnitude(device.second.lastData.magnetometer);

            if (accMag > ACCELERATION_THRESHOLD && gyroMag > GYROSCOPE_THRESHOLD && magMag > MAGNETOMETER_THRESHOLD) {
                device.second.isWorn = true;  // Device is worn
            } else {
                device.second.isWorn = false; // Device is not worn
            }
        }
    }

    // Function to display the status of wearable devices
    void displayDeviceStatus() {
        std::cout << "Wearable Device Status:" << std::endl;
        for (const auto& device : devices) {
            std::cout << "ID: " << device.second.id
                      << ", Worn: " << (device.second.isWorn ? "Yes" : "No") << std::endl;
        }
    }
};

int main() {
    WearableDetectionSystem wds;

    // Add some devices
    wds.addDevice(1);
    wds.addDevice(2);

    // Simulate recording sensor data
    SensorData data1 = {{2.0f, 1.5f, 0.8f}, {0.5f, 1.0f, 0.3f}, {1.2f, 0.9f, 1.0f}};
    SensorData data2 = {{0.5f, 0.2f, 0.1f}, {0.1f, 0.3f, 0.05f}, {0.4f, 0.3f, 0.2f}};

    wds.recordSensorData(1, data1);
    wds.recordSensorData(2, data2);

    // Detect wear status based on thresholds
    wds.detectWearStatus();

    // Display the results
    wds.displayDeviceStatus();

    return 0;
}
